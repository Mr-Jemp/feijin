<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link href="../css/mui.min.css" rel="stylesheet"/>
    <link href="../css/style.css" rel="stylesheet"/>
	<title>搜索结果页</title>
	<style>
		.mui-pull-bottom-tips{
			display: none;
		}
	</style>
</head>
<body id="searchWarp">
	<header id="header" class="mui-bar mui-bar-nav header">
		<a class="mui-action-back mui-icon mui-pull-left back"></a>
		<h1 class="search mui-title mui-input-row">
			<p class="search-Box">
				<em></em>
				<input type="text" id="search-text" class="input_search mui-input-clear" placeholder="大家都在搜">
			</p>			
		</h1>
		<a id="search-btn" class="mui-btn mui-btn-link mui-pull-right text">搜索</a>
	</header>
	<div class="main mui-content mui-fullscreen">		
		<div id="slider" class="searchList mui-slider mui-fullscreen">
			<div id="sliderSegmentedControl" class="mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
				<a class="mui-control-item" href="#item0">金融超市</a>
				<a class="mui-control-item" href="#item1">股市内参</a>
				<a class="mui-control-item" href="#item2">理财课堂</a>
				<a class="mui-control-item" href="#item3">社区</a>
			</div>
			<div id="sliderProgressBar" class="mui-slider-progress-bar mui-col-xs-3"></div>
			<div class="mui-slider-group">
				<div id="item0" class="mui-slider-item mui-control-content mui-active">
					<div class="mui-scroll-wrapper mui-content">
						<div class="mui-scroll">
							<template v-if="datas.financial.totalCount > 0">
								<style>
									#item0 .mui-pull-bottom-tips{
										display: block;
									}
								</style>
								<div class="result-num">
									<p><em></em><span><strong>{{datas.financial.totalCount}}</strong>个搜索结果</span><em></em></p>
								</div>
								<ul class="mui-table-view textContent">
									<template v-for="(item,data) in datas.financial.result">
										<li id="{{data.id}}">
											<div class="img">
												<img src="{{data.thumbnailPath}}" alt="" />
											</div>
											<p>{{data.name}}</p>
										</li>
									</template>									
								</ul>
							</template>
						</div>
							<template v-if="datas.financial.totalCount == 0">
								<div class="result-num">
									<p><em></em><span>暂无搜索结果</span><em></em></p>
								</div>
							</template>	
					</div>
				</div>
				<div id="item1" class="mui-slider-item mui-control-content">
					<div class="mui-scroll-wrapper mui-content">
						<div class="mui-scroll">
							<template v-if="datas.stock.totalCount > 0">
								<style>
									#item1 .mui-pull-bottom-tips{
										display: block;
									}
								</style>
								<div class="result-num">
									<p><em></em><span><strong>{{datas.stock.totalCount}}</strong>个搜索结果</span><em></em></p>
								</div>
								<ul class="mui-table-view textContent">
									<template v-for="(item,data) in datas.stock.result">
										<li id="{{data.id}}">
											<div class="img">
												<img src="{{data.thumbnailPath}}" alt="" />
											</div>
											<p>{{data.name}}</p>
										</li>
									</template>									
								</ul>
							</template>
							<template v-if="datas.stock.totalCount == 0">
								<div class="result-num">
									<p><em></em><span>暂无搜索结果</span><em></em></p>
								</div>
							</template>	
						</div>
					</div>
				</div>
				<div id="item2" class="mui-slider-item mui-control-content">
					<div class="mui-scroll-wrapper mui-content">
						<div class="mui-scroll">
							<template v-if="datas.class.totalCount > 0">
								<style>
									#item2 .mui-pull-bottom-tips{
										display: block;
									}
								</style>
								<div class="result-num">
									<p><em></em><span><strong>{{datas.class.totalCount}}</strong>个搜索结果</span><em></em></p>
								</div>
								<ul class="mui-table-view textContent">
									<template v-for="(item,data) in datas.class.result">
										<li id="{{data.id}}">
											<div class="img">
												<img src="{{data.thumbnailPath}}" alt="" />
											</div>
											<p>{{data.name}}</p>
										</li>
									</template>									
								</ul>
							</template>
							<template v-if="datas.class.totalCount == 0">
								<div class="result-num">
									<p><em></em><span>暂无搜索结果</span><em></em></p>
								</div>
							</template>	
						</div>
					</div>
				</div>
				<div id="item3" class="mui-slider-item mui-control-content">
					<div class="mui-scroll-wrapper mui-content">
						<div class="mui-scroll">
							<template v-if="datas.community.totalCount > 0">
								<style>
									#item3 .mui-pull-bottom-tips{
										display: block;
									}
								</style>
								<div class="result-num">
									<p><em></em><span><strong>{{datas.community.totalCount}}</strong>个搜索结果</span><em></em></p>
								</div>
								<ul class="mui-table-view textContent">
									<template v-for="(item,data) in datas.community.result">
										<li id="{{data.id}}">
											<div class="img">
												<img src="{{data.thumbnailPath}}" alt="" />
											</div>
											<p>{{data.name}}</p>
										</li>
									</template>									
								</ul>
							</template>
							<template v-if="datas.community.totalCount == 0">
								<div class="result-num">
									<p><em></em><span>暂无搜索结果</span><em></em></p>
								</div>
							</template>	
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</body>
	<script src="../js/mui.min.js"></script>
	<script src="../js/conf.js"></script>
	<script src="../js/vue.min.js"></script>
	<script src="../js/mui.pullToRefresh.js"></script>
	<script src="../js/mui.pullToRefresh.material.js"></script>
	<script>
		(function($, doc){
			var input = document.getElementById("search-text");
			setTimeout(function() {
				mui.trigger(input,'tap');
				input.focus();
			}, 300);

			var search = document.getElementById("search-btn");
			var vm = null;
			var param;
			search.addEventListener('tap',function(){
				$.app.pageNo = 1;
				param = document.getElementById("search-text").value;
				if (param != '') {
					$.ajax({
						type: "POST",
						url: api_domain + "home/query",
						dataType: "json",
						contentType:"application/json",
						data: {
							"param": param
						},
						async: false,
						success: function(data) {
							if (data["result"] != 1) {
								mui.toast(data["msg"]);
								return;
							}

							if (vm != null) {
								vm.datas = data["data"];
								vm.$nextTick(function(){});
								return;
							}
							
							$.app.pageNo++;
							
							vm = new Vue({
								el: '#searchWarp',
								data: {
									datas:data["data"]
								}
							});

						},
						error:function(data){
							mui.toast(data.msg);
						}
					});
				}else{
					mui.toast("请输入搜索关键词");
				}
			})

			var createFragment = function(ul, index, data) {
				var length = ul.querySelectorAll('li').length;
				var fragment = document.createDocumentFragment();
				var li0;
				var li1;
				var li2;
				var li3;
				if (index == 1) {
					for(var i = 0; i < data.financial["result"].length; i++) {
						var item = data.financial["result"][i];
						li0 = document.createElement('li');
						li0.setAttribute("id", item["id"]);
						li0.innerHTML = '<div class="img">' +
										'<img src="' + item["thumbnailPath"] + '" alt="" />' +
										'</div>' +
										'<p>' + item["name"] + '</p>';
						// 刷新出来的li内容
						fragment.appendChild(li0);
					}
				}
				if (index == 2){
					for(var j = 0; j < data.stock["result"].length; j++) {
						var item = data.stock["result"][j];
						li1 = document.createElement('li');
						li1.setAttribute("id", item["id"]);
						li1.innerHTML = '<div class="img">' +
										'<img src="' + item["thumbnailPath"] + '" alt="" />' +
										'</div>' +
										'<p>' + item["name"] + '</p>';
						// 刷新出来的li内容
						fragment.appendChild(li1);
					}
				}
				if (index == 3) {
					for(var k = 0; k < data.class["result"].length; k++) {
						var item = data.class["result"][k];
						li2 = document.createElement('li');
						li2.setAttribute("id", item["id"]);
						li2.innerHTML = '<div class="img">' +
										'<img src="' + item["thumbnailPath"] + '" alt="" />' +
										'</div>' +
										'<p>' + item["name"] + '</p>';
						// 刷新出来的li内容
						fragment.appendChild(li2);
					}
				}
				if (index == 4) {
					for(var m = 0; m < data.community["result"].length; m++) {
						var item = data.community["result"][m];
						li3 = document.createElement('li');
						li3.setAttribute("id", item["id"]);
						li3.innerHTML = '<div class="img">' +
										'<img src="' + item["thumbnailPath"] + '" alt="" />' +
										'</div>' +
										'<p>' + item["name"] + '</p>';
						// 刷新出来的li内容
						fragment.appendChild(li3);
					}
				}					
				return fragment;
			};

			$.app.pullToRefresh(
				function(self, index) { // down
					var url = api_domain + 'home/query';
					var ul = self.element.querySelector('.mui-table-view');
					var data = {
						"param" : param
					};
					$.app.post(url, data, function(data) {
						ul.innerHTML = "";
						ul.appendChild(createFragment(ul, index, data));
					})
				},
				function(self, index) { // up
					index = index + 1;
					var url = api_domain + 'home/query?pageNo=' + $.app.pageNo;
					var ul = self.element.querySelector('.mui-table-view');
					var data = {
						"param" : param
					};					
					$.app.post(url, data, function(data) {
						ul.appendChild(createFragment(ul, index, data));
						$.app.pageNo++;
					})
				}
			)

			//$.plusReady(function() {
				$('#item0').on('tap', "li", function() {
					var id = this.getAttribute("id");
					$.app.openWindow("../financial-market/detail.html?id=" + id);
				})
				$('#item1').on('tap', "li", function() {
					var id = this.getAttribute("id");
					$.app.openWindow("../information/detail.html?id=" + id);
				})
				$('#item2').on('tap', "li", function() {
					var id = this.getAttribute("id");
					$.app.openWindow("../wealth-classroom/detail.html?id=" + id);
				})
				$('#item3').on('tap', "li", function() {
					var id = this.getAttribute("id");
					$.app.openWindow("../community/detail.html?id=" + id);
				})
			//});
					
		})(mui, document)
	</script>
</html>